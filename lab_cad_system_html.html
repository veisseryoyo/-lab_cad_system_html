<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab CAD Pro - ××¢×¨×›×ª × ×™×”×•×œ ××¢×‘×“×•×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1f2937 100%);
            color: white;
            min-height: 100vh;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: #1f2937;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .login-box h1 {
            color: #60a5fa;
            text-align: center;
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .login-box p {
            text-align: center;
            color: #9ca3af;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #3b82f6;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .info-box {
            background: #374151;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        
        .info-box p {
            font-size: 12px;
            color: #9ca3af;
            margin: 5px 0;
            text-align: right;
        }
        
        /* Dashboard Styles */
        .dashboard {
            display: none;
            height: 100vh;
            overflow: hidden;
        }
        
        .dashboard.active {
            display: flex;
        }
        
        .sidebar {
            width: 250px;
            background: #1f2937;
            border-right: 2px solid #3b82f6;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 2px solid #3b82f6;
        }
        
        .sidebar-header h2 {
            color: #60a5fa;
            font-size: 20px;
        }
        
        .sidebar-menu {
            flex: 1;
            padding: 20px;
        }
        
        .menu-item {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background: transparent;
            border: none;
            color: #9ca3af;
            text-align: right;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .menu-item:hover {
            background: #374151;
        }
        
        .menu-item.active {
            background: #3b82f6;
            color: white;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 2px solid #3b82f6;
        }
        
        .user-name {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .btn-logout {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid #ef4444;
            color: #ef4444;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background: #ef4444;
            color: white;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .top-bar {
            background: #1f2937;
            padding: 20px 30px;
            border-bottom: 2px solid #3b82f6;
        }
        
        .top-bar h2 {
            font-size: 24px;
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #111827;
        }
        
        .card {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .btn-add {
            padding: 12px 24px;
            background: #10b981;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .btn-add:hover {
            background: #059669;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
            font-size: 18px;
        }
        
        canvas {
            border: 2px solid #3b82f6;
            background: white;
            border-radius: 8px;
            cursor: crosshair;
            width: 100%;
            max-width: 100%;
        }
        
        .tool-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-tool {
            padding: 10px 20px;
            background: #374151;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-tool.active {
            background: #3b82f6;
        }
        
        .btn-tool:hover {
            background: #4b5563;
        }
        
        .grid {
            display: grid;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            background: #374151;
            border: 1px solid #4b5563;
            border-radius: 4px;
            color: white;
            font-size: 13px;
        }
        
        textarea {
            resize: vertical;
            font-family: inherit;
        }
        
        .btn-delete {
            padding: 5px 10px;
            background: transparent;
            border: 1px solid #ef4444;
            color: #ef4444;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-delete:hover {
            background: #ef4444;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #1f2937;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
        }
        
        .stat-card p {
            color: #9ca3af;
            margin-bottom: 10px;
        }
        
        .stat-card h3 {
            font-size: 36px;
            color: #60a5fa;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            background: #7f1d1d;
            border: 2px solid #ef4444;
            color: #fca5a5;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .add-user-section {
            background: #374151;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .add-user-section h3 {
            margin-bottom: 15px;
            color: #60a5fa;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>Lab CAD Pro</h1>
            <p>××¢×¨×›×ª × ×™×”×•×œ ××¢×‘×“×•×ª ××§×™×¤×”</p>
            <div class="form-group">
                <label>×©× ××©×ª××©</label>
                <input type="text" id="usernameInput" placeholder="×”×›× ×¡ ×©× ××©×ª××©">
            </div>
            <div class="form-group">
                <label>×¡×™×¡××”</label>
                <input type="password" id="passwordInput" placeholder="×”×›× ×¡ ×¡×™×¡××”">
            </div>
            <button class="btn-primary" onclick="login()">×›× ×™×¡×”</button>
            <div id="loginError"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardScreen" class="dashboard">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Lab CAD Pro</h2>
            </div>
            <div class="sidebar-menu" id="sidebarMenu">
                <!-- Menu items will be inserted here -->
            </div>
            <div class="sidebar-footer">
                <div class="user-name" id="userName"></div>
                <button class="btn-logout" onclick="logout()">×™×¦×™××”</button>
            </div>
        </div>
        <div class="main-content">
            <div class="top-bar">
                <h2 id="pageTitle">Dashboard</h2>
            </div>
            <div class="content-area" id="contentArea">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // State
        let currentUser = null;
        let currentTab = 'cad';
        let shapes = [];
        let selectedTool = 'line';
        let isDrawing = false;
        let startPos = null;
        let experiments = [];
        let inventory = [];
        let equipment = [];
        let maintenance = [];
        let safety = [];
        let finances = [];

        const users = {
            admin: { role: 'admin', password: 'admin123', name: '×× ×”×œ ××¢×¨×›×ª' },
            engineer: { role: 'engineer', password: 'eng123', name: '××”× ×“×¡' },
            chemist: { role: 'chemist', password: 'chem123', name: '×›×™×××™' },
            finance: { role: 'finance', password: 'fin123', name: '×—×©×‘×•× ××™' }
        };

        const permissions = {
            admin: ['cad', 'finances', 'inventory', 'experiments', 'equipment', 'maintenance', 'safety', 'users', 'reports', 'analytics'],
            engineer: ['cad', 'inventory', 'experiments', 'equipment', 'maintenance', 'reports', 'analytics'],
            chemist: ['cad', 'inventory', 'experiments', 'safety', 'reports', 'analytics'],
            finance: ['finances', 'equipment', 'reports', 'analytics']
        };

        const tabTitles = {
            cad: 'ğŸ“ CAD - ×¦×™×•×¨×™× ×“×™×•×§×™×™×',
            experiments: 'ğŸ§ª × ×™×¡×•×™×™× ××“×¢×™×™×',
            inventory: 'ğŸ“¦ ××œ××™ ×—×•××¨×™×',
            equipment: 'âš™ï¸ × ×™×”×•×œ ×¦×™×•×“',
            maintenance: 'ğŸ”§ ××—×–×§×” ×ª×§×•×¤×ª×™×ª',
            safety: 'âš ï¸ ×‘×˜×™×—×•×ª ×•×“×•×—×•×ª',
            finances: 'ğŸ’° × ×™×”×•×œ ×›×¡×¤×™×',
            users: 'ğŸ‘¥ × ×™×”×•×œ ××©×ª××©×™×',
            reports: 'ğŸ“Š ×“×•×—×•×ª ××§×™×¤×™×',
            analytics: 'ğŸ“ˆ ×× ×œ×™×˜×™×§×” ×•×¡×˜×˜×™×¡×˜×™×§×”'
        };

        // Login
        function login() {
            const username = document.getElementById('usernameInput').value;
            const password = document.getElementById('passwordInput').value;
            const user = users[username];
            const errorDiv = document.getElementById('loginError');

            if (user && user.password === password) {
                currentUser = { username, role: user.role, name: user.name };
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboardScreen').classList.add('active');
                document.getElementById('userName').textContent = currentUser.name;
                renderMenu();
                changeTab('cad');
                errorDiv.innerHTML = '';
            } else {
                errorDiv.innerHTML = '<div class="error-message">âŒ ×©× ××©×ª××© ××• ×¡×™×¡××” ×©×’×•×™×™×. ×× × × ×¡×” ×©× ×™×ª.</div>';
            }
        }

        // Logout
        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('usernameInput').value = '';
            document.getElementById('passwordInput').value = '';
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.innerHTML = '';
            }
        }

        // Render Menu
        function renderMenu() {
            const menu = document.getElementById('sidebarMenu');
            const tabs = permissions[currentUser.role];
            const menuItems = {
                cad: 'ğŸ“ CAD',
                experiments: 'ğŸ§ª × ×™×¡×•×™×™×',
                inventory: 'ğŸ“¦ ××œ××™',
                equipment: 'âš™ï¸ ×¦×™×•×“',
                maintenance: 'ğŸ”§ ××—×–×§×”',
                safety: 'âš ï¸ ×‘×˜×™×—×•×ª',
                finances: 'ğŸ’° ×›×¡×¤×™×',
                users: 'ğŸ‘¥ ××©×ª××©×™×',
                reports: 'ğŸ“Š ×“×•×—×•×ª',
                analytics: 'ğŸ“ˆ ×× ×œ×™×˜×™×§×”'
            };

            menu.innerHTML = '';
            tabs.forEach(tab => {
                const btn = document.createElement('button');
                btn.className = 'menu-item';
                btn.textContent = menuItems[tab];
                btn.onclick = () => changeTab(tab);
                menu.appendChild(btn);
            });
        }

        // Change Tab
        function changeTab(tab) {
            currentTab = tab;
            document.getElementById('pageTitle').textContent = tabTitles[tab];
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeIndex = permissions[currentUser.role].indexOf(tab);
            if (activeIndex >= 0) {
                document.querySelectorAll('.menu-item')[activeIndex].classList.add('active');
            }

            renderContent();
        }

        // Render Content
        function renderContent() {
            const content = document.getElementById('contentArea');
            
            switch(currentTab) {
                case 'cad':
                    content.innerHTML = `
                        <div class="card">
                            <p style="margin-bottom: 15px;">ğŸ–±ï¸ ×”× ×—×™×•×ª: ×‘×—×¨ ×›×œ×™ â†’ ×œ×—×¥ ×•×’×¨×•×¨ ×¢×œ ×”-canvas</p>
                            <div class="tool-bar">
                                <button class="btn-tool ${selectedTool === 'line' ? 'active' : ''}" onclick="selectTool('line')">â” ×§×•</button>
                                <button class="btn-tool ${selectedTool === 'circle' ? 'active' : ''}" onclick="selectTool('circle')">â—‹ ×¢×™×’×•×œ</button>
                                <button class="btn-tool ${selectedTool === 'rect' ? 'active' : ''}" onclick="selectTool('rect')">â–­ ××¨×•×‘×¢</button>
                                <button class="btn-tool" onclick="clearCanvas()" style="background: #ef4444;">ğŸ—‘ï¸ × ×§×”</button>
                            </div>
                        </div>
                        <canvas id="canvas" width="1200" height="600"></canvas>
                    `;
                    setTimeout(initCanvas, 0);
                    break;

                case 'experiments':
                    if (experiments.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addExperiment()">â• × ×™×¡×•×™ ×—×“×©</button>
                            <div class="empty-state">ğŸ§ª ××™×Ÿ × ×™×¡×•×™×™× ×¢×“×™×™×Ÿ. ×œ×—×¥ ×¢×œ "× ×™×¡×•×™ ×—×“×©"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addExperiment()">â• × ×™×¡×•×™ ×—×“×©</button>
                            ${experiments.map((exp, i) => `
                                <div class="card">
                                    <div class="grid grid-3">
                                        <input type="text" value="${exp.name}" onchange="updateExp(${i}, 'name', this.value)">
                                        <select onchange="updateExp(${i}, 'status', this.value)">
                                            <option ${exp.status === 'planning' ? 'selected' : ''}>planning</option>
                                            <option ${exp.status === 'in-progress' ? 'selected' : ''}>in-progress</option>
                                            <option ${exp.status === 'completed' ? 'selected' : ''}>completed</option>
                                        </select>
                                        <input type="date" value="${exp.date}" onchange="updateExp(${i}, 'date', this.value)">
                                    </div>
                                    <textarea onchange="updateExp(${i}, 'desc', this.value)" rows="2">${exp.desc}</textarea>
                                    <button class="btn-delete" onclick="deleteExp(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                        `;
                    }
                    break;

                case 'inventory':
                    if (inventory.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addInventory()">â• ×—×•××¨ ×—×“×©</button>
                            <div class="empty-state">ğŸ“¦ ××™×Ÿ ×¤×¨×™×˜×™× ×‘××œ××™. ×œ×—×¥ ×¢×œ "×—×•××¨ ×—×“×©"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addInventory()">â• ×—×•××¨ ×—×“×©</button>
                            ${inventory.map((item, i) => `
                                <div class="card">
                                    <div class="grid grid-4">
                                        <input type="text" value="${item.name}" onchange="updateInv(${i}, 'name', this.value)" placeholder="×©×">
                                        <input type="text" value="${item.formula}" onchange="updateInv(${i}, 'formula', this.value)" placeholder="× ×•×¡×—×”">
                                        <input type="number" value="${item.quantity}" onchange="updateInv(${i}, 'quantity', this.value)" placeholder="×›××•×ª">
                                        <input type="date" value="${item.expiry}" onchange="updateInv(${i}, 'expiry', this.value)">
                                    </div>
                                    <button class="btn-delete" onclick="deleteInv(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                        `;
                    }
                    break;

                case 'equipment':
                    if (equipment.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addEquipment()">â• ×¦×™×•×“ ×—×“×©</button>
                            <div class="empty-state">âš™ï¸ ××™×Ÿ ×¦×™×•×“ ×‘××¢×¨×›×ª. ×œ×—×¥ ×¢×œ "×¦×™×•×“ ×—×“×©"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addEquipment()">â• ×¦×™×•×“ ×—×“×©</button>
                            ${equipment.map((eq, i) => `
                                <div class="card">
                                    <div class="grid grid-3">
                                        <input type="text" value="${eq.name}" onchange="updateEq(${i}, 'name', this.value)" placeholder="×©×">
                                        <select onchange="updateEq(${i}, 'status', this.value)">
                                            <option ${eq.status === 'operational' ? 'selected' : ''}>operational</option>
                                            <option ${eq.status === 'maintenance' ? 'selected' : ''}>maintenance</option>
                                            <option ${eq.status === 'broken' ? 'selected' : ''}>broken</option>
                                        </select>
                                        <input type="date" value="${eq.calibration}" onchange="updateEq(${i}, 'calibration', this.value)">
                                    </div>
                                    <button class="btn-delete" onclick="deleteEq(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                        `;
                    }
                    break;

                case 'maintenance':
                    if (maintenance.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addMaintenance()">â• ××—×–×§×” ×—×“×©×”</button>
                            <div class="empty-state">ğŸ”§ ××™×Ÿ ×¤×¢×•×œ×•×ª ××—×–×§×”. ×œ×—×¥ ×¢×œ "××—×–×§×” ×—×“×©×”"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addMaintenance()">â• ××—×–×§×” ×—×“×©×”</button>
                            ${maintenance.map((m, i) => `
                                <div class="card">
                                    <div class="grid grid-3">
                                        <input type="text" value="${m.equipment}" onchange="updateMain(${i}, 'equipment', this.value)" placeholder="×¦×™×•×“">
                                        <input type="date" value="${m.date}" onchange="updateMain(${i}, 'date', this.value)">
                                        <input type="text" value="${m.tech}" onchange="updateMain(${i}, 'tech', this.value)" placeholder="×˜×›× ××™">
                                    </div>
                                    <textarea onchange="updateMain(${i}, 'desc', this.value)" rows="2">${m.desc}</textarea>
                                    <button class="btn-delete" onclick="deleteMain(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                        `;
                    }
                    break;

                case 'safety':
                    if (safety.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addSafety()">â• ×“×•"×— ×—×“×©</button>
                            <div class="empty-state">âš ï¸ ××™×Ÿ ×“×•×—×•×ª ×‘×˜×™×—×•×ª. ×œ×—×¥ ×¢×œ "×“×•×´×— ×—×“×©"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addSafety()">â• ×“×•"×— ×—×“×©</button>
                            ${safety.map((s, i) => `
                                <div class="card" style="border-color: ${s.severity === 'high' ? '#ef4444' : s.severity === 'medium' ? '#f59e0b' : '#10b981'};">
                                    <div class="grid grid-3">
                                        <input type="date" value="${s.date}" onchange="updateSafe(${i}, 'date', this.value)">
                                        <select onchange="updateSafe(${i}, 'severity', this.value)">
                                            <option ${s.severity === 'low' ? 'selected' : ''}>low</option>
                                            <option ${s.severity === 'medium' ? 'selected' : ''}>medium</option>
                                            <option ${s.severity === 'high' ? 'selected' : ''}>high</option>
                                        </select>
                                        <label><input type="checkbox" ${s.resolved ? 'checked' : ''} onchange="updateSafe(${i}, 'resolved', this.checked)"> ×¤×ª×•×¨</label>
                                    </div>
                                    <textarea onchange="updateSafe(${i}, 'desc', this.value)" rows="2">${s.desc}</textarea>
                                    <button class="btn-delete" onclick="deleteSafe(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                        `;
                    }
                    break;

                case 'finances':
                    const totalExp = finances.filter(f => f.type === 'expense' && f.approved).reduce((s, f) => s + f.amount, 0);
                    const totalInc = finances.filter(f => f.type === 'income' && f.approved).reduce((s, f) => s + f.amount, 0);
                    
                    if (finances.length === 0) {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addFinance()">â• ×¤×¨×™×˜ ×›×¡×¤×™</button>
                            <div class="empty-state">ğŸ’° ××™×Ÿ ×¨×©×•××•×ª ×›×¡×¤×™×•×ª. ×œ×—×¥ ×¢×œ "×¤×¨×™×˜ ×›×¡×¤×™"!</div>
                        `;
                    } else {
                        content.innerHTML = `
                            <button class="btn-add" onclick="addFinance()">â• ×¤×¨×™×˜ ×›×¡×¤×™</button>
                            ${finances.map((f, i) => `
                                <div class="card">
                                    <div class="grid grid-4">
                                        <input type="date" value="${f.date}" onchange="updateFin(${i}, 'date', this.value)">
                                        <select onchange="updateFin(${i}, 'type', this.value)">
                                            <option ${f.type === 'expense' ? 'selected' : ''}>expense</option>
                                            <option ${f.type === 'income' ? 'selected' : ''}>income</option>
                                        </select>
                                        <input type="text" value="${f.desc}" onchange="updateFin(${i}, 'desc', this.value)" placeholder="×ª×™××•×¨">
                                        <input type="number" value="${f.amount}" onchange="updateFin(${i}, 'amount', this.value)" placeholder="×¡×›×•×">
                                    </div>
                                    <label><input type="checkbox" ${f.approved ? 'checked' : ''} onchange="updateFin(${i}, 'approved', this.checked)"> ××•×©×¨</label>
                                    <button class="btn-delete" onclick="deleteFin(${i})">ğŸ—‘ï¸ ××—×§</button>
                                </div>
                            `).join('')}
                            <div class="stats-grid">
                                <div class="stat-card"><p>×¡×”"×› ×”×•×¦××•×ª</p><h3 style="color: #ef4444;">${totalExp}â‚ª</h3></div>
                                <div class="stat-card"><p>×¡×”"×› ×”×›× ×¡×•×ª</p><h3 style="color: #10b981;">${totalInc}â‚ª</h3></div>
                                <div class="stat-card"><p>×™×ª×¨×”</p><h3>${totalInc - totalExp}â‚ª</h3></div>
                            </div>
                        `;
                    }
                    break;

                case 'users':
                    if (currentUser.role === 'admin') {
                        content.innerHTML = `
                            <div class="add-user-section">
                                <h3>â• ×”×•×¡×£ ××©×ª××© ×—×“×©</h3>
                                <div class="grid grid-4" style="margin-bottom: 15px;">
                                    <input type="text" id="newUsername" placeholder="×©× ××©×ª××©">
                                    <input type="text" id="newName" placeholder="×©× ××œ×">
                                    <input type="password" id="newPassword" placeholder="×¡×™×¡××”">
                                    <select id="newRole">
                                        <option value="engineer">ğŸ”§ ××”× ×“×¡</option>
                                        <option value="chemist">ğŸ§ª ×›×™×××™</option>
                                        <option value="finance">ğŸ’° ×—×©×‘×•× ××™</option>
                                        <option value="admin">ğŸ‘‘ ×× ×”×œ</option>
                                    </select>
                                </div>
                                <button class="btn-add" onclick="addNewUser()">â• ×”×•×¡×£ ××©×ª××©</button>
                                <div id="userMessage"></div>
                            </div>
                            <div class="card">
                                <h3 style="margin-bottom: 20px;">ğŸ‘¥ ×¨×©×™××ª ××©×ª××©×™×</h3>
                                ${Object.entries(users).map(([username, user]) => `
                                    <div style="background: #374151; padding: 15px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <p style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">${user.name}</p>
                                            <p style="font-size: 13px; color: #9ca3af;">@${username} â€¢ ×¡×™×¡××”: ${user.password} â€¢ ${user.role}</p>
                                        </div>
                                        ${username !== 'admin' ? `<button class="btn-delete" onclick="deleteUser('${username}')">ğŸ—‘ï¸ ××—×§</button>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        content.innerHTML = `
                            <div class="card">
                                <h3 style="margin-bottom: 20px;">ğŸ‘¥ ×¨×©×™××ª ××©×ª××©×™×</h3>
                                ${Object.entries(users).map(([username, user]) => `
                                    <div style="background: #374151; padding: 15px; margin-bottom: 10px; border-radius: 6px;">
                                        <p style="font-size: 16px; font-weight: bold; margin-bottom: 5px;">${user.name}</p>
                                        <p style="font-size: 13px; color: #9ca3af;">@${username} â€¢ ${user.role}</p>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                    break;

                case 'reports':
                    content.innerHTML = `
                        <div class="stats-grid">
                            <div class="stat-card"><p>×¡×”"×› × ×™×¡×•×™×™×</p><h3>${experiments.length}</h3></div>
                            <div class="stat-card"><p>×¡×”"×› ×—×•××¨×™×</p><h3>${inventory.length}</h3></div>
                            <div class="stat-card"><p>×¡×”"×› ×¦×™×•×“</p><h3>${equipment.length}</h3></div>
                            <div class="stat-card"><p>×¤×¢×•×œ×•×ª ××—×–×§×”</p><h3>${maintenance.length}</h3></div>
                            <div class="stat-card"><p>×“×•×—×•×ª ×‘×˜×™×—×•×ª</p><h3>${safety.length}</h3></div>
                            <div class="stat-card"><p>××©×ª××©×™×</p><h3>${Object.keys(users).length}</h3></div>
                        </div>
                    `;
                    break;

                case 'analytics':
                    const totalExpenses = finances.filter(f => f.type === 'expense' && f.approved).reduce((s, f) => s + f.amount, 0);
                    const totalIncome = finances.filter(f => f.type === 'income' && f.approved).reduce((s, f) => s + f.amount, 0);
                    content.innerHTML = `
                        <div class="card">
                            <h3 style="margin-bottom: 20px;">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×›×œ×œ×™×•×ª</h3>
                            <p>ğŸ‘¥ ×¡×”"×› ××©×ª××©×™×: <strong>${Object.keys(users).length}</strong></p>
                            <p>ğŸ§ª ×¡×”"×› × ×™×¡×•×™×™×: <strong>${experiments.length}</strong></p>
                            <p>ğŸ“¦ ×¡×”"×› ×—×•××¨×™×: <strong>${inventory.length}</strong></p>
                            <p>âš™ï¸ ×¡×”"×› ×¦×™×•×“: <strong>${equipment.length}</strong></p>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 20px;">ğŸ’¹ × ×™×ª×•×— ×›×¡×¤×™</h3>
                            <p>ğŸ“ˆ ×¡×”"×› ×”×•×¦××•×ª: <strong style="color: #ef4444;">${totalExpenses}â‚ª</strong></p>
                            <p>ğŸ“Š ×¡×”"×› ×”×›× ×¡×•×ª: <strong style="color: #10b981;">${totalIncome}â‚ª</strong></p>
                            <p>ğŸ¯ ×™×ª×¨×”: <strong style="color: #3b82f6;">${totalIncome - totalExpenses}â‚ª</strong></p>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 20px;">âš ï¸ ××–×”×¨×•×ª ×•×¡×˜×˜×•×¡</h3>
                            ${safety.filter(s => !s.resolved).length > 0 ? 
                                `<p style="color: #ef4444;">ğŸš¨ <strong>${safety.filter(s => !s.resolved).length}</strong> ×“×•×—×•×ª ×‘×˜×™×—×•×ª ×œ× ×¤×ª×•×¨×™×!</p>` : 
                                `<p style="color: #10b981;">âœ… ×”×›×œ × ×¨××” ××¦×•×™×Ÿ! ××™×Ÿ ×”×ª×¨××•×ª ×‘××¢×¨×›×ª.</p>`
                            }
                        </div>
                    `;
                    break;
            }
        }

        // Canvas Functions
        function initCanvas() {
            const canvas = document.getElementById('canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            drawCanvas(ctx);
            
            canvas.onmousedown = (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                startPos = { x, y };
                isDrawing = true;
            };
            
            canvas.onmousemove = (e) => {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                
                drawCanvas(ctx);
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 2;
                
                if (selectedTool === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(startPos.x, startPos.y);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                } else if (selectedTool === 'circle') {
                    const radius = Math.sqrt((x - startPos.x) ** 2 + (y - startPos.y) ** 2);
                    ctx.beginPath();
                    ctx.arc(startPos.x, startPos.y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (selectedTool === 'rect') {
                    ctx.strokeRect(startPos.x, startPos.y, x - startPos.x, y - startPos.y);
                }
            };
            
            canvas.onmouseup = (e) => {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                const y = (e.clientY - rect.top) * (canvas.height / rect.height);
                
                shapes.push({
                    type: selectedTool,
                    x1: startPos.x,
                    y1: startPos.y,
                    x2: x,
                    y2: y
                });
                
                isDrawing = false;
                drawCanvas(ctx);
            };
            
            canvas.onmouseleave = () => {
                isDrawing = false;
            };
        }

        function drawCanvas(ctx) {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            // Grid
            ctx.strokeStyle = '#e5e5e5';
            ctx.lineWidth = 1;
            for (let i = 0; i < ctx.canvas.width; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, ctx.canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < ctx.canvas.height; i += 20) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(ctx.canvas.width, i);
                ctx.stroke();
            }
            
            // Shapes
            shapes.forEach(shape => {
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                
                if (shape.type === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(shape.x1, shape.y1);
                    ctx.lineTo(shape.x2, shape.y2);
                    ctx.stroke();
                } else if (shape.type === 'circle') {
                    const radius = Math.sqrt((shape.x2 - shape.x1) ** 2 + (shape.y2 - shape.y1) ** 2);
                    ctx.beginPath();
                    ctx.arc(shape.x1, shape.y1, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (shape.type === 'rect') {
                    ctx.strokeRect(shape.x1, shape.y1, shape.x2 - shape.x1, shape.y2 - shape.y1);
                }
            });
        }

        function selectTool(tool) {
            selectedTool = tool;
            renderContent();
        }

        function clearCanvas() {
            shapes = [];
            const canvas = document.getElementById('canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                drawCanvas(ctx);
            }
        }

        // CRUD Functions
        function addExperiment() {
            experiments.push({
                name: '× ×™×¡×•×™ ×—×“×©',
                status: 'planning',
                date: new Date().toISOString().split('T')[0],
                desc: ''
            });
            renderContent();
        }

        function updateExp(i, field, value) {
            experiments[i][field] = value;
        }

        function deleteExp(i) {
            experiments.splice(i, 1);
            renderContent();
        }

        function addInventory() {
            inventory.push({
                name: '×—×•××¨ ×—×“×©',
                formula: '',
                quantity: 0,
                expiry: new Date().toISOString().split('T')[0]
            });
            renderContent();
        }

        function updateInv(i, field, value) {
            inventory[i][field] = value;
        }

        function deleteInv(i) {
            inventory.splice(i, 1);
            renderContent();
        }

        function addEquipment() {
            equipment.push({
                name: '×¦×™×•×“ ×—×“×©',
                status: 'operational',
                calibration: new Date().toISOString().split('T')[0]
            });
            renderContent();
        }

        function updateEq(i, field, value) {
            equipment[i][field] = value;
        }

        function deleteEq(i) {
            equipment.splice(i, 1);
            renderContent();
        }

        function addMaintenance() {
            maintenance.push({
                equipment: '',
                date: new Date().toISOString().split('T')[0],
                tech: '',
                desc: ''
            });
            renderContent();
        }

        function updateMain(i, field, value) {
            maintenance[i][field] = value;
        }

        function deleteMain(i) {
            maintenance.splice(i, 1);
            renderContent();
        }

        function addSafety() {
            safety.push({
                date: new Date().toISOString().split('T')[0],
                severity: 'low',
                desc: '',
                resolved: false
            });
            renderContent();
        }

        function updateSafe(i, field, value) {
            safety[i][field] = value;
        }

        function deleteSafe(i) {
            safety.splice(i, 1);
            renderContent();
        }

        function addFinance() {
            finances.push({
                date: new Date().toISOString().split('T')[0],
                type: 'expense',
                desc: '×¤×¨×™×˜ ×—×“×©',
                amount: 0,
                approved: false
            });
            renderContent();
        }

        function updateFin(i, field, value) {
            if (field === 'amount') {
                finances[i][field] = parseFloat(value) || 0;
            } else {
                finances[i][field] = value;
            }
        }

        function deleteFin(i) {
            finances.splice(i, 1);
            renderContent();
        }
        
        // User Management (Admin Only)
        function addNewUser() {
            const username = document.getElementById('newUsername').value.trim();
            const name = document.getElementById('newName').value.trim();
            const password = document.getElementById('newPassword').value.trim();
            const role = document.getElementById('newRole').value;
            const messageDiv = document.getElementById('userMessage');
            
            if (!username || !name || !password) {
                messageDiv.innerHTML = '<div class="error-message">âš ï¸ × × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª</div>';
                return;
            }
            
            if (users[username]) {
                messageDiv.innerHTML = '<div class="error-message">âš ï¸ ×©× ×”××©×ª××© ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª</div>';
                return;
            }
            
            users[username] = {
                role: role,
                password: password,
                name: name
            };
            
            messageDiv.innerHTML = '<div style="background: #065f46; border: 2px solid #10b981; color: #86efac; padding: 15px; border-radius: 6px; margin-top: 15px; text-align: center; font-weight: bold;">âœ… ×”××©×ª××© × ×•×¡×£ ×‘×”×¦×œ×—×”!</div>';
            
            // Clear inputs
            document.getElementById('newUsername').value = '';
            document.getElementById('newName').value = '';
            document.getElementById('newPassword').value = '';
            
            setTimeout(() => {
                renderContent();
            }, 1500);
        }
        
        function deleteUser(username) {
            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×ª××© ${users[username].name}?`)) {
                delete users[username];
                renderContent();
            }
        }
    </script>
</body>
</html>